## Disclaimer
This guide is for development / demonstration purpose only and does NOT reflect a production setup.

## New Knative environment
### Download and run Knative quickstart

Follow the Knative quickstart guide to get a local kind/minikube environment with Knative capabilities.

It is basically 4 commands on Mac:

```bash
#install knative
brew install knative/client/kn

#install knative quickstart sandbox
brew install knative-sandbox/kn-plugins/quickstart

#install kind
brew install kind

#install quickstart cluster
kn quickstart kind
```
That will get you a ready to go knative/kubernetes environment.


See Knative documentation here: 
https://knative.dev/docs/install/quickstart-install/


## Database
start a single-node cockroachdb as statefulset

```bash
kubectl apply -f https://raw.githubusercontent.com/zitadel/zitadel/v2-alpha/deploy/knative/cockroachdb-statefulset-single-node.yaml
```

## Secret for TLS termination
create a secret with your certificates for TLS termination

```bash
#describe happy path 
kubectl apply secret -f certs.yaml
```


## Start ZITADEL with Knative 
```bash

# start zitadel

kn service create zitadel \
--image ghcr.io/zitadel/zitadel:v2.0.0-v2-alpha.33-amd64 \
--port 8080 \
--env ZITADEL_DATABASE_HOST=cockroachdb \
--env ZITADEL_EXTERNALSECURE=false \
--env ZITADEL_EXTERNALPORT=80 \
--env ZITADEL_TLS_ENABLED=false \
--env ZITADEL_EXTERNALDOMAIN=zitadel.default.127.0.0.1.sslip.io \
--env ZITADEL_S3DEFAULTINSTANCE_CUSTOMDOMAIN=zitadel.default.127.0.0.1.sslip.io \
--arg "admin" --arg "start-from-init" --arg "--masterkey" --arg "MasterkeyNeedsToHave32Characters" \
--mount /tls.secret=secret:certs/tls.secret \
--mount /tls.key=secret:certs/tls.key
```

or use the knative service yaml

```bash
kubectl apply -f https://raw.githubusercontent.com/zitadel/zitadel/v2-alpha/deploy/knative/zitadel-knative-service.yaml
```

## Get started with ZIDATEL
```bash
#get ZIDATEL URL
kn services list

NAME      URL                                         LATEST          AGE   CONDITIONS   READY   REASON
zitadel   http://zitadel.default.127.0.0.1.sslip.io   zitadel-00001   10m   3 OK / 3     True
```

Add the console path to the URL and open in browser
http://zitadel.default.127.0.0.1.sslip.io/ui/console

If you didn't configure something else, this is the default IAM admin users login:

* username: zitadel-admin@zitadel.localhost
* password: Password1!

