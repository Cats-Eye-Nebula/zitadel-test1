FROM golang:1.17-alpine3.13

WORKDIR /go/src/github.com/caos/zitadel

#download modules
COPY ./go.* ./
RUN go mod download

COPY . .

ARG UID=1000
ARG GID=1000

# Create a group and user
RUN addgroup -S tmpgroup -g $GID && adduser -S tmpuser -G tmpgroup -u $UID

RUN chown -R tmpuser:tmpgroup .

CMD [ "su", "-", "tmpuser", "-c", "./build/local/e2e-setup.sh" ]
